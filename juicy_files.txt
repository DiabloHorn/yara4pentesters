rule ntds_file : usernames hashed_passwords active_directory windows
{
    meta:
        author = "DiabloHorn https://diablohorn.com"
        description = "find the ntds.dit file"
    strings:
        $filemagic = {ef cd ab 89}
        $content_string = "Admin-Display-Name" nocase wide
        $content_string2 = "Address-Entry-Display-Table-MSDOS" nocase wide
        $content_string3 = "nTDSDSA-Display" nocase wide
        $content_string4 = "MSysObjects" nocase ascii
        $content_string5 = "ObjidTable" nocase ascii
    condition:
        ($filemagic at 4) and (int32(12) == 0 or int32(12) == 1) and all of ($content_*)
}

rule hive_file : usernames hashed_passwords registry windows
{
    meta:
        author = "DiabloHorn https://diablohorn.com"
        description = "find registry hive files like system/security/sam"
    strings:
        $filemagic = "regf"
        $filemagicbin = "hbin"
        $content_string = "ROOT"
    condition:
        $filemagic at 0 and $filemagicbin at 4096 and $content_string
        
}

rule shadow_file : usernames hashed_passwords linux
{
    meta:
        author = "DiabloHorn https://diablohorn.com"
        description = "find shadow files"
    strings:
        $rootline = /root:.:\d+?:\d+?:\d+?:\d+?:/
        $hashline = /:\$\d\$/
        $hashtype_md5 = ":$1$"
        $hashtype_blowfish = ":$2a$"
        $hashtype_blowfish2 = ":$2y$"
        $hashtype_sha256 = ":$5$"
        $hashtype_sha512 = ":$6$"
    condition:
        $rootline and $hashline and (1 of ($hashtype_*))
}

rule tomcat_file : usernames plain_passwords
{
    meta:
        author = "DiabloHorn https://diablohorn.com"
        description = "find tomcat config file with plaintext passwords"
    strings:
        $xml_ident = "<tomcat-users>"
        $xml_ident2 = "</tomcat-users>"
        $roles = "<role rolename="
        $password_string = "username="
        $password_string2 = "password="
        $password_string3 = "roles="
    condition:
        all of them
}



